<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Faculty Whereabouts</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #eef2f7, #dbe5f5);
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      background: radial-gradient(circle at 60% 40%, #2563eb 0%, #1e3a8a 100%);
      color: #fff;
      padding: 0.7em 2vw;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      height: 7.5vh;
      border-radius: 5px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(16, 34, 74, .10);
      border: 2px solid #2563eb;
    }

    .header-center {
      text-align: center;
      flex: 1;
      color: #fff;
      font-family: 'Orbitron', 'Inter', Arial, sans-serif;
    }

    .header-center h1 {
      margin: 0;
      font-size: 3.5vh;
      font-weight: 700;
      text-shadow: 1px 1px 2px #00000077;
    }

    .header-center h2 {
      margin: 0;
      font-size: 3vh;
      font-weight: 500;
      text-shadow: 1px 1px 2px #00000055;
    }

    #clock {
      position: fixed;
      right: 2vw;
      bottom: 10vh;
      z-index: 1000;
      background: #111827;
      border-radius: 10px;
      padding: 0.5em 0.4em;
      width: 280px;
      height: 80px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #38bdf8;
      box-shadow: 0 0 16px #38bdf888, 0 0 4px #2563eb;
      white-space: nowrap;
      gap: 0.1em;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 1vh;
      padding: 1vh 2vw;
      box-sizing: border-box;
      /* Height set dynamically by JS */
      overflow: visible;
    }

    .card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 28px -6px rgba(16, 34, 74, .14), 0 4px 12px -4px rgba(16, 34, 74, .12);
      color: #1e3a8a;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      font-size: 1.6vh;
      overflow: hidden;
      word-break: break-word;
      box-sizing: border-box;
      padding: 1vh 0.5vw;
      /* Increased vertical padding */
    }

    .card img {
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(16, 34, 74, .10);
      border: 2px solid #2563eb;
      width: 6vh;
      height: 6vh;
      object-fit: cover;
      margin-bottom: 0.5vh;
    }

    .card h3 {
      color: #2563eb;
      font-weight: 600;
      margin-bottom: 0.1em;
    }

    .card div,
    .card i,
    .status {
      color: #374151;
      font-weight: 500;
    }

    .status {
      border-radius: 8px;
      padding: 0.2em 0.7em;
      font-size: 1em;
      box-shadow: 0 2px 8px rgba(16, 34, 74, .08);
      display: inline-block;
    }

    .status.in_class {
      background: #e0e7ff;
      color: #2563eb;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.at_dept {
      background: #d1fae5;
      color: #059669;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.in_meeting {
      background: #fef3c7;
      color: #b45309;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.on_leave {
      background: #fee2e2;
      color: #dc2626;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.off_duty {
      background: #e5e7eb;
      color: #374151;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.on_weekend {
      background: #ffe4e6;
      color: #be123c;
      border-radius: 8px;
      font-weight: 600;
    }

    .status.postponed {
      background: #fecaca;
      color: #991b1b;
      border-radius: 8px;
      font-weight: 600;
    }

    ::-webkit-scrollbar {
      width: 8px;
      background: #dbe5f5;
    }

    ::-webkit-scrollbar-thumb {
      background: #2563eb;
      border-radius: 8px;
    }

    .icon-phone,
    .icon-email {
      width: 1.4em;
      height: 1.4em;
      vertical-align: middle;
      margin-right: 0.4em;
      color: #2563eb;
      background: rgba(37, 99, 235, 0.1);
      border-radius: 50%;
      padding: 0.2em;
      transition: all 0.2s ease;
    }

    .icon-phone:hover,
    .icon-email:hover {
      background: rgba(37, 99, 235, 0.2);
      transform: scale(1.1);
    }

    @media (max-width: 1000px) {
      .grid {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        grid-template-rows: auto;
      }
    }

    /* --- Ad Overlay Styles --- */
    #adOverlay {
      position: fixed;
      left: 0;
      /* top and height set dynamically by JS */
      width: 100vw;
      background: rgba(0, 0, 0, 0.85);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      display: flex;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.7s;
    }

    #adOverlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    #adOverlay img,
    #adOverlay video {
      display: none;
      background:#000;
      width:100%;
      height:100%;
      max-width:100%;
      max-height:100%;
      object-fit: contain;
      opacity: 1;
    }

    #adOverlay.stretch-horizontal img,
    #adOverlay.stretch-horizontal video {
      width: 100%;
      height: auto;
      max-height: 100%;
      object-fit: contain;
    }

    #adOverlay.stretch-vertical img,
    #adOverlay.stretch-vertical video {
      height: 100%;
      width: auto;
      max-width: 100%;
      object-fit: contain;
    }

    /* --- Marquee Footer Styles --- */
    #marqueeFooter {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100vw;
      height: 2em;
      background: #1e293b;
      color: #fff;
      font-size: 1em;
      z-index: 10000;
      overflow: hidden;
      font-family: 'Orbitron', 'Inter', Arial, sans-serif;
    }

    #dateDisplay {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: #2563eb;
      color: #fff;
      padding: 0.2em 0.6em;
      font-weight: 600;
      white-space: nowrap;
      border-right: 2px solid #38bdf8;
      min-width: 120px;
      max-width: 150px;
      text-align: center;
      box-shadow: 0 0 8px #2563eb44;
      font-size: 0.85em;
      line-height: 1.1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      z-index: 10002;
    }

    #marqueeText {
      position: absolute;
      left: 150px;
      top: 0;
      bottom: 0;
      right: 0;
      white-space: nowrap;
      will-change: transform;
      overflow: visible;
      transform: translateZ(0);
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      padding-left: 1em;
    }

    #adProgress {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 6px;
      background: #1e3a8a;
      z-index: 10001;
    }

    #adProgressBar {
      height: 100%;
      background: #2563eb;
      width: 0;
      transition: width 0.2s;
    }

    /* 7-segment digit SVG component */
    .seven-segment {
      width: 32px !important;
      height: 56px !important;
      display: inline-block;
      vertical-align: middle;
    }

    .seven-segment .seg {
      fill: #333;
      /* Changed from #222 to slightly lighter */
      transition: fill 0.2s;
      opacity: 0.25;
      /* Make unlit segments barely visible */
    }

    .seven-segment .seg.lit {
      fill: #38bdf8;
      filter: drop-shadow(0 0 6px #38bdf8);
      opacity: 1;
      /* Full opacity for lit segments */
    }

    .digit-bg {
      background: #222;
      border-radius: 6px;
      margin: 0 1px;
      display: inline-block;
      box-shadow: 0 0 8px #222;
    }

    .colon {
      margin: 0 1px;
    }

    .ampm {
      display: inline-block;
      width: 2em;
      text-align: left;
      font-size: 0.9em;
      margin-left: 0.3em;
      color: #60a5fa;
      letter-spacing: 0.2em;
      vertical-align: middle;
      font-family: 'Orbitron', 'Inter', 'Segoe UI', monospace, Arial, sans-serif;
    }
  </style>
</head>

<body>
  <header>
    <img src="images/ugv_logo.png" alt="UGV Logo" class="logo">
    <div class="header-center">
      <h1>Department of Computer Science & Engineering</h1>
      <h2>University of Global Village</h2>
    </div>
    <div id="clock"></div>
    <img src="images/cse_logo.png" alt="CSE Logo" class="logo">
  </header>

  <div id="grid" class="grid"></div>

  <!-- Ad Overlay -->
  <div id="adOverlay">
    <img id="adImage" src="" />
    <video id="adVideo"
       autoplay
       muted
       playsinline
       webkit-playsinline
       preload="auto"
       crossorigin="anonymous"></video>
    <div id="adProgress">
      <div id="adProgressBar"></div>
    </div>
  </div>

  <!-- Marquee Footer -->
  <footer id="marqueeFooter">
    <div id="dateDisplay"></div>
    <div id="marqueeText"></div>
  </footer>

  <script>
    const STATUS_MAP = {
      in_class: "In Class",
      at_dept: "At Department",
      on_leave: "On Leave",
      off_duty: "Off Duty",
      in_meeting: "In Meeting",
      on_weekend: "On Weekend",
      postponed: "Class Postponed"
    };

    const SEGMENTS = {
      "0": ["a", "b", "c", "d", "e", "f"],
      "1": ["b", "c"],
      "2": ["a", "b", "g", "e", "d"],
      "3": ["a", "b", "g", "c", "d"],
      "4": ["f", "g", "b", "c"],
      "5": ["a", "f", "g", "c", "d"],
      "6": ["a", "f", "g", "e", "c", "d"],
      "7": ["a", "b", "c"],
      "8": ["a", "b", "c", "d", "e", "f", "g"],
      "9": ["a", "b", "c", "d", "f", "g"]
    };

    // Add these missing declarations:
    let ads = [];
    let nextAdTimeout = null;
    let marqueeAnimation = null; // Track the animation

    function loadFaculty() {
      fetch("https://faculty-status-backend.onrender.com/api/faculty", {
        credentials: "include"
      })
        .then(res => res.json())
        .then(data => {
          const grid = document.getElementById("grid");
          grid.innerHTML = ""; // Clear once

          // Build all HTML at once instead of concatenating
          const cardsHTML = data.map(f => {
            let statusObj = f.manualOverride ?? f.status;
            let statusStr, room, batch;

            if (typeof statusObj === "string") {
              statusStr = statusObj;
              room = null;
              batch = null;
            } else if (typeof statusObj === "object" && statusObj !== null) {
              statusStr = statusObj.status;
              room = statusObj.room ?? null;
              batch = statusObj.batch ?? null;
            }

            let extraInfo = "";
            if (statusStr === "in_class" && room && batch) {
              extraInfo = `<small class="text-gray">with ${batch} at ${room}</small>`;
            }

            return `
              <div class="card">
                <img src="https://faculty-status-backend.onrender.com${f.image}" alt="${f.name}">
                <h3>${f.name}</h3>
                <div>${f.designation || ""}</div>
                <div>${f.contact ? `<svg class="icon-phone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg> ${f.contact}` : ""}</div>
                <div>${f.email ? `<svg class="icon-email" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg> ${f.email}` : ""}</div>
                <div class="status ${statusStr}">
                  ${STATUS_MAP[statusStr] || statusStr} ${extraInfo}
                </div>
              </div>`;
          }).join('');

          grid.innerHTML = cardsHTML; // Set all at once
        });
    }

    function renderDigit(digit) {
      const segs = SEGMENTS[digit] || [];
      return `
    <span class="digit-bg">
      <svg width="32" height="56" viewBox="0 0 32 56" class="seven-segment">
        <rect class="seg seg-a${segs.includes('a') ? ' lit' : ''}" x="4" y="2" width="24" height="4" rx="2"/>
        <rect class="seg seg-b${segs.includes('b') ? ' lit' : ''}" x="26" y="6" width="4" height="20" rx="2"/>
        <rect class="seg seg-c${segs.includes('c') ? ' lit' : ''}" x="26" y="30" width="4" height="20" rx="2"/>
        <rect class="seg seg-d${segs.includes('d') ? ' lit' : ''}" x="4" y="50" width="24" height="4" rx="2"/>
        <rect class="seg seg-e${segs.includes('e') ? ' lit' : ''}" x="2" y="30" width="4" height="20" rx="2"/>
        <rect class="seg seg-f${segs.includes('f') ? ' lit' : ''}" x="2" y="6" width="4" height="20" rx="2"/>
        <rect class="seg seg-g${segs.includes('g') ? ' lit' : ''}" x="4" y="26" width="24" height="4" rx="2"/>
      </svg>
    </span>
  `;
    }

    function renderColon() {
      return `
    <span class="digit-bg colon">
      <svg width="12" height="56" viewBox="0 0 12 56">
        <circle cx="6" cy="16" r="3" fill="#38bdf8" filter="url(#glow)"/>
        <circle cx="6" cy="40" r="3" fill="#38bdf8" filter="url(#glow)"/>
        <defs>
          <filter id="glow" x="-5" y="-5" width="22" height="22">
            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
      </svg>
    </span>
  `;
    }

    function renderClock(h, m, s, ampm) {
      const digits = [
        ...String(h).padStart(2, '0'),
        ...String(m).padStart(2, '0'),
        ...String(s).padStart(2, '0')
      ];
      const html =
        renderDigit(digits[0]) +
        renderDigit(digits[1]) +
        renderColon() +
        renderDigit(digits[2]) +
        renderDigit(digits[3]) +
        renderColon() +
        renderDigit(digits[4]) +
        renderDigit(digits[5]) +
        `<span class="ampm">${ampm}</span>`;
      document.getElementById("clock").innerHTML = html;
    }

    function updateClock() {
      const now = new Date();
      let h = now.getHours();
      let m = now.getMinutes();
      let s = now.getSeconds();
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      h = h ? h : 12;
      renderClock(h, m, s, ampm);
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Initial setup
      updateClock();
      updateDate();
      loadFaculty();
      loadMarquee();
      loadAds(); // Load ads initially
      adjustLayout();

      // Start marquee animation ONCE
      setTimeout(() => {
        animateMarquee();
      }, 1000);

      // Set up intervals (only once)
      setInterval(updateClock, 1000);
      setInterval(loadFaculty, 3000);
      setInterval(loadMarquee, 300000);
      setInterval(loadAds, 300000); // Refresh ads every 10 minutes
      setInterval(updateDate, 60000);
    });

    window.addEventListener("resize", adjustLayout);

    function adjustLayout() {
      const header = document.querySelector("header");
      const footer = document.getElementById("marqueeFooter");
      const grid = document.getElementById("grid");
      const overlay = document.getElementById("adOverlay");
      const headerHeight = header.offsetHeight;
      const footerHeight = footer.offsetHeight;
      grid.style.height = `calc(100vh - ${headerHeight}px - ${footerHeight}px)`;
      overlay.style.top = headerHeight + "px";
      overlay.style.height = `calc(100vh - ${headerHeight}px - ${footerHeight}px)`;
    }
    // DELETE THESE TOO:
    // window.addEventListener("resize", adjustLayout);
    // window.addEventListener("DOMContentLoaded", adjustLayout);

    // Helper: Show/hide overlay with fade
    function showOverlay() {
      const overlay = document.getElementById("adOverlay");
      overlay.classList.add("active");
    }
    function hideOverlay() {
      const overlay = document.getElementById("adOverlay");
      overlay.classList.remove("active");
      overlay.classList.remove("stretch-horizontal");
      overlay.classList.remove("stretch-vertical");
    }

    // Helper: Stretch ad to fill horizontally or vertically, keeping aspect ratio
    function setAdStretch(mediaEl) {
      const overlay = document.getElementById("adOverlay");
      overlay.classList.remove("stretch-horizontal", "stretch-vertical");
      const overlayRect = overlay.getBoundingClientRect();
      let mediaWidth, mediaHeight;
      if (mediaEl.tagName === "IMG") {
        mediaWidth = mediaEl.naturalWidth;
        mediaHeight = mediaEl.naturalHeight;
      } else if (mediaEl.tagName === "VIDEO") {
        mediaWidth = mediaEl.videoWidth;
        mediaHeight = mediaEl.videoHeight;
      }
      if ((mediaWidth / mediaHeight) > (overlayRect.width / overlayRect.height)) {
        overlay.classList.add("stretch-horizontal");
      } else {
        overlay.classList.add("stretch-vertical");
      }
    }

    // Fetch ads and start sequence
    function loadAds() {
      fetch("https://faculty-status-backend.onrender.com/api/ads")
        .then(res => res.json())
        .then(data => {
          ads = data;
          console.log(`Loaded ${ads.length} ads`); // Optional: for debugging
        })
        .catch(err => {
          console.error("Failed to load ads:", err);
        });
    }

    loadAds();
    setTimeout(() => {
      if (ads.length) runAdSequence();
    }, 1000); // Small delay to ensure ads are loaded

    function updateAdProgress(duration, elapsed = 0) {
      const bar = document.getElementById("adProgressBar");
      bar.style.width = ((elapsed / duration) * 100) + "%";
    }

    function runAdSequence() {
      let totalAdTime = 0;
      let current = 0;

      const overlay = document.getElementById("adOverlay");
      const adImage = document.getElementById("adImage");
      const adVideo = document.getElementById("adVideo");

      showOverlay();

      function showNextAd() {
        if (current >= ads.length) {
          hideOverlay();
          // Break logic
          let breakMs = 60000; // default 1 min
          if (totalAdTime > 120000) breakMs = 240000; // >2min: 4min
          else if (totalAdTime > 30000) breakMs = 120000; // >30s: 2min
          nextAdTimeout = setTimeout(runAdSequence, breakMs);
          return;
        }

        const ad = ads[current];
        adImage.style.display = "none";
        adVideo.style.display = "none";

        if (ad.type === "image") {
          adImage.src = "https://faculty-status-backend.onrender.com" + ad.src;
          adImage.onload = () => {
            adImage.style.display = "block";
            setAdStretch(adImage);
          };
          let elapsed = 0;
          const duration = 20000;
          updateAdProgress(duration, 0);
          const progressInterval = setInterval(() => {
            elapsed += 200;
            updateAdProgress(duration, elapsed);
            if (elapsed >= duration) clearInterval(progressInterval);
          }, 200);
          setTimeout(() => {
            adImage.style.display = "none";
            updateAdProgress(duration, duration);
            current++;
            showNextAd();
          }, duration);
          totalAdTime += duration;
        } else if (ad.type === "video") {
          const src = "https://faculty-status-backend.onrender.com" + ad.src;
          adVideo.pause();
          adVideo.removeAttribute("src");
          adVideo.load();
          adVideo.style.display = "none";

          let metaTimeout, safetyTimeout, progressInterval;

          function clearAll(next = true) {
            clearTimeout(metaTimeout);
            clearTimeout(safetyTimeout);
            if (progressInterval) clearInterval(progressInterval);
            adVideo.onloadedmetadata = null;
            adVideo.onerror = null;
            adVideo.onstalled = null;
            adVideo.onabort = null;
            adVideo.onended = null;
            if (next) {
              adVideo.style.display = "none";
              current++;
              showNextAd();
            }
          }

          adVideo.onloadedmetadata = () => {
            console.log("Video metadata loaded, duration:", adVideo.duration);
            adVideo.style.display = "block";
            setAdStretch(adVideo);
            
            const durMs = isFinite(adVideo.duration) && adVideo.duration > 0
              ? adVideo.duration * 1000
              : 15000; // fallback duration
            
            adVideo.play().catch(err => {
              console.warn("Play() rejected, skipping video:", err);
              clearAll(true);
              return;
            });

            updateAdProgress(durMs, 0);
            progressInterval = setInterval(() => {
              if (!adVideo.paused && !adVideo.ended) {
                updateAdProgress(durMs, adVideo.currentTime * 1000);
              }
            }, 250);

            adVideo.onended = () => {
              console.log("Video ended naturally at:", adVideo.currentTime, "of", adVideo.duration);
              updateAdProgress(durMs, durMs);
              totalAdTime += durMs;
              clearAll(true);
            };

            // Safety: force advance if ended not received (with proper duration)
            safetyTimeout = setTimeout(() => {
              // Only force close if video is actually near the end or stalled
              if (adVideo.currentTime >= (adVideo.duration - 2) || adVideo.currentTime === 0) {
                console.warn("Video safety timeout reached, forcing next. Current time:", adVideo.currentTime, "Duration:", adVideo.duration);
                totalAdTime += durMs;
                clearAll(true);
              } else {
                console.log("Video still playing normally, extending timeout");
                // Extend timeout if video is still playing normally
                safetyTimeout = setTimeout(() => {
                  totalAdTime += durMs;
                  clearAll(true);
                }, 10000); // Additional 10 seconds
              }
            }, durMs + 15000); // 15 second buffer
          };

          adVideo.onerror = (e) => {
            console.error("Video error:", e, src);
            clearAll(true);
          };

          adVideo.onstalled = () => {
            console.warn("Video stalled, skipping:", src);
            clearAll(true);
          };

          adVideo.onabort = () => {
            console.warn("Video aborted:", src);
            clearAll(true);
          };

          // If metadata not received in 10s skip (increased from 5s for slow loading)
          metaTimeout = setTimeout(() => {
            console.warn("Metadata timeout (10s), skipping video:", src);
            clearAll(true);
          }, 10000);

          adVideo.src = src;
          adVideo.load();
        }
      }

      showNextAd();
    }

    function loadMarquee() {
      fetch("https://faculty-status-backend.onrender.com/api/marquee")
        .then(res => res.text())
        .then(text => {
          const marquee = document.getElementById("marqueeText");
          marquee.textContent = text;
          // Don't call animateMarquee() here - let the existing animation handle the new text
        });
    }

    function animateMarquee() {
      const marquee = document.getElementById("marqueeText");
      
      // Clear any existing animation
      if (marqueeAnimation) {
        clearTimeout(marqueeAnimation);
      }

      function loop() {
        // Get the available width (marquee container width)
        const containerWidth = marquee.offsetWidth;
        
        // Start from the right edge of the container
        marquee.style.transition = "none";
        marquee.style.transform = `translateX(${containerWidth}px)`;
        
        setTimeout(() => {
          // Get the actual text width
          const textWidth = marquee.scrollWidth;
          const duration = Math.max(15, textWidth / 80);
          marquee.style.transition = `transform ${duration}s linear`;
          // Move text completely off screen to the left
          marquee.style.transform = `translateX(-${textWidth}px)`;
          
          // Schedule next loop
          marqueeAnimation = setTimeout(loop, duration * 1000 + 500);
        }, 100);
      }
      loop();
    }

    function updateDate() {
      const now = new Date();
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      const dayName = days[now.getDay()];
      const day = now.getDate();
      const month = months[now.getMonth()];
      const year = now.getFullYear();

      // Compact format with line break
      const dateStr = `<div>${dayName}, ${day} ${month}</div><div>${year}</div>`;
      document.getElementById("dateDisplay").innerHTML = dateStr;
    }
  </script>
</body>

</html>